<div class="breadcrumb mb-5">
  <div class="page-title">
    <img src="/assets/icons/back-arrow.svg" alt="Back Button" />
    <h4>{{ subscription.customerName }}</h4>
  </div>
  <span>Review village details and information</span>
</div>

<div class="subscription-container mb-5">
  <div class="header">
    <div>
      <strong>Plan:</strong> {{ subscription.subscriptionTypeName }}
    </div>
    <div>
      <strong>Payment:</strong> ${{ subscription.paymentPerMonth }} <span class="subtext">/ per month</span>
    </div>
    <div>
      <strong>Start:</strong> {{ subscription.startDate }}
    </div>
    <div>
      <strong>End:</strong> {{ subscription.endDate }}
    </div>
    <div class="actions">
      <button class="cancel">Cancel subscription</button>
      <button class="upgrade">Upgrade</button>
    </div>
  </div>

  <div class="usage-section">
    <div class="usage-card">
      <div>Admins</div>
      <div class="bar">
        <div class="progress" [style.width.%]="getProgress(subscription.usedAdmins, subscription.adminNumber)"></div>
      </div>
      <div>{{ subscription.usedAdmins }} / {{ subscription.adminNumber }}</div>
    </div>

    <div class="usage-card">
      <div>Devices</div>
      <div class="bar">
        <div class="progress" [style.width.%]="getProgress(subscription.usedDevices, subscription.deviceNumber)"></div>
      </div>
      <div>{{ subscription.usedDevices }} / {{ subscription.deviceNumber }}</div>
    </div>

    <div class="usage-card">
      <div>Cards</div>
      <div class="bar">
        <div class="progress" [style.width.%]="getProgress(subscription.usedCards, subscription.cardNumber)"></div>
      </div>
      <div>{{ subscription.usedCards }} / {{ subscription.cardNumber }}</div>
    </div>
  </div>
</div>

<!--SECTION TWO  SUBSCRIPTION DEVICES-->
<div class="devices-container">
  <div class="devices-header">
    <div class="title">
      <strong>Devices</strong> <span class="count">({{ subscription.devices.length }})</span>
    </div>
    <div class="actions">
      <dx-button class="button-info me-1" text="Add Device" (onClick)="showAddDevicePopup()">
      </dx-button>
      <a href="#" class="view-all">View All</a>
    </div>
  </div>

  <div class="devices-slider">
    <div class="device-card" *ngFor="let device of subscription.devices">
      <img [src]="device.image" alt="Device image" class="device-img" />
      <div class="device-name">{{ device.name }}</div>
      <div class="device-status active">{{ device.active ? 'Active' : 'Inactive' }}</div>

      <div class="device-info">
        <label><input type="checkbox" disabled /> Status:</label>
        <label>
          <input type="checkbox" disabled />
          Mac Address: <span class="mac">{{ device.macAddress }}</span>
        </label>
        <label><input type="checkbox" disabled /> Device type: {{ device.deviceTypeName }}</label>
      </div>
    </div>
  </div>
</div>

<!--ADD DEVICE POPUP-->
<dx-popup [width]="600" [height]="450" [showTitle]="true" title="Add New Device" [dragEnabled]="true"
  [hideOnOutsideClick]="true" [showCloseButton]="true" [(visible)]="popupVisible">
  <dx-form [formData]="deviceData" [colCount]="1" [labelLocation]="'top'">


    <dxi-item dataField="selectedDevices" editorType="dxTagBox" [editorOptions]="{
            dataSource: devicesList,
            placeholder: 'Select devices',
            valueExpr: 'id',
            displayExpr: 'name',
            itemTemplate: 'deviceTemplate',
            showSelectionControls: true,
            searchEnabled: true
          }">
      <dxi-validation-rule type="required" message="At least one device is required"></dxi-validation-rule>
      <dxo-label text="Devices" [visible]="true"></dxo-label>
    </dxi-item>

    <!-- Device Template for showing image + name -->
    <ng-template #deviceTemplate let-data>
      <div class="device-item">
        <img [src]="data.imagePath" alt="Device image" width="30" height="30" style="margin-right: 8px;" />
        <span>{{data.name}}</span>
      </div>
    </ng-template>



  </dx-form>
  <dxi-item itemType="button">
    <dx-button text="Add Device" type="success" (onClick)="submitDevice()"></dx-button>
  </dxi-item>

</dx-popup>